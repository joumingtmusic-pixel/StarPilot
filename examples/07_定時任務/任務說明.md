# ⏰ 定時任務

## 🎯 任務目標

學習如何用自然語言讓 AI 幫你建立自動執行的排程任務，讓工具在背景默默工作。

---

## 💡 為什麼需要定時任務？

### 手動執行（原本的方式）
```
❌ 每天早上 9 點手動執行報表生成
❌ 每週一手動備份檔案
❌ 每小時手動檢查網頁更新
❌ 容易忘記、效率低下
```

### 自動執行（定時任務）
```
✅ 設定一次，自動重複執行
✅ 不需要人工介入
✅ 24/7 不間斷運作
✅ 準時準確，不會忘記
```

---

## 💬 與 AI 的對話範例

### 情境 1：每日自動生成報表

```
👤：我想建立一個定時任務
    每天早上 8 點自動執行
    生成昨天的銷售報表
    儲存到 reports/ 資料夾

🤖：好的！我會建立兩個部分：
    1. 報表生成程式（generate_report.py）
    2. 排程設定
    
    你想用哪種排程方式？
    A. Windows 工作排程器
    B. Python schedule 套件
    C. cron（Linux/Mac）

👤：我用 Windows，選 A

🤖：了解！我會：
    1. 建立報表生成程式
    2. 產生 PowerShell 腳本來設定排程
    
    [生成完成]
    
    ✅ 已建立：
    - generate_report.py（報表程式）
    - setup_schedule.ps1（排程設定）
    
    執行步驟：
    1. 以系統管理員身分開啟 PowerShell
    2. 執行：.\setup_schedule.ps1
    3. 排程已設定！明天早上 8 點會自動執行

👤：可以測試看看嗎？

🤖：當然！執行：python generate_report.py
    [執行中...]
    ✅ 報表已生成：reports\sales_2024-03-20.xlsx
```

---

### 情境 2：每週自動備份檔案

```
👤：我想每週日晚上 11 點
    自動備份 documents 資料夾
    壓縮後上傳到雲端硬碟

🤖：了解！這個任務包含：
    1. 壓縮檔案
    2. 上傳到雲端
    3. 清理舊備份（保留最近 4 週）
    
    請問要上傳到哪個雲端？
    A. Google Drive
    B. Dropbox
    C. OneDrive

👤：Google Drive

🤖：好的！我需要你先完成 Google Drive API 設定
    [提供設定步驟...]
    
    設定完成後，我會建立：
    1. backup.py（備份程式）
    2. 排程設定腳本
    
    每週日 23:00 自動執行
    備份命名：backup_YYYY-MM-DD.zip

👤：如果上傳失敗怎麼辦？

🤖：我會加上錯誤處理：
    - 自動重試 3 次
    - 失敗時寄送通知信
    - 記錄到 log 檔案
```

---

### 情境 3：每小時監控網頁變化

```
👤：我想監控競爭對手的價格
    每小時檢查一次
    如果價格有變動就通知我

🤖：好的！我會建立監控系統：
    
    1. 價格檢查程式（check_price.py）
       - 訪問目標網頁
       - 提取價格資訊
       - 比對是否變動
    
    2. 通知系統
       - Line Notify（即時通知）
       - Email（詳細報告）
    
    3. 排程設定
       - 每小時執行一次
    
    請問要監控哪個網址？

👤：https://example.com/product/12345

🤖：了解！正在建立監控系統...
    [完成]
    
    ✅ 監控系統已建立
    
    功能：
    - 每小時自動檢查價格
    - 價格變動時立即通知
    - 記錄歷史價格（可畫趨勢圖）
    
    執行 setup_monitor.py 啟動監控

👤：可以同時監控多個商品嗎？

🤖：可以！請提供商品清單（CSV 或 Excel）
    包含：商品名稱、網址、價格選擇器
    我會修改成批次監控模式
```

---

### 情境 4：工作日早上發送每日摘要

```
👤：我想建立一個每日摘要系統
    週一到週五早上 8:30
    自動整理以下資訊並寄信給我：
    - 昨日銷售數字
    - 待處理訂單數量
    - 庫存警告（低於 10 件的商品）

🤖：了解！我會建立完整的每日摘要系統
    
    正在設計...
    [完成]
    
    ✅ 每日摘要系統
    
    1. daily_summary.py
       - 從資料庫撈取數據
       - 生成 HTML 格式郵件
       - 包含圖表和表格
    
    2. email_template.html
       - 專業的郵件範本
       - 響應式設計（手機友善）
    
    3. 排程設定
       - 週一至週五 08:30 執行
       - 假日自動跳過
    
    請提供：
    - 收件人信箱
    - SMTP 設定（寄件伺服器）

👤：如果某天資料有問題怎麼辦？

🤖：我會加上智能處理：
    - 資料異常時顯示警告標記
    - 無法取得資料時使用前一天的數據
    - 並在郵件中註明
    - 嚴重錯誤時寄送錯誤通知給管理員
```

---

## 🎓 學到的技巧

1. **排程設定**：使用系統工具或程式套件設定定時執行
2. **錯誤處理**：自動重試、記錄日誌、異常通知
3. **資源管理**：避免重複執行、控制資源使用
4. **通知機制**：Email、Line、Slack 等通知整合
5. **日誌記錄**：追蹤執行歷史、除錯問題

---

## 🚀 現在輪到你了！

開啟 Copilot Chat (`Ctrl+I` 或 `Cmd+I`)，試著對話：

### 練習 1：簡單定時報表
```
「建立一個定時任務
 每天早上 9 點自動生成 Excel 報表
 使用 Windows 工作排程器」
```

### 練習 2：週期性備份
```
「建立每週備份任務
 每週日晚上 10 點
 自動壓縮並備份 data 資料夾」
```

### 練習 3：價格監控
```
「建立網頁監控系統
 每小時檢查商品價格
 價格變動時發送 Email 通知」
```

### 練習 4：每日摘要
```
「建立每日摘要系統
 週一到週五早上 8 點
 寄送昨日數據摘要信」
```

---

## 💡 提示

### 排程時間設定技巧

**1. 避開尖峰時段**
```
✅ 好的時間：
- 深夜執行大量資料處理（23:00-05:00）
- 上班前完成報表（07:00-08:00）
- 午休時間執行（12:00-13:00）

❌ 不好的時間：
- 上班時間執行耗資源任務
- 系統備份期間執行
```

**2. 考慮依賴關係**
```
任務 A：資料收集（每天 01:00）
任務 B：資料分析（每天 02:00）← 依賴 A
任務 C：報表生成（每天 03:00）← 依賴 B

確保前一個任務完成後，下一個才開始
```

**3. 設定合理的間隔**
```
- 即時性高的任務：每 5-15 分鐘
- 一般監控任務：每 30-60 分鐘
- 資料統計任務：每天一次
- 備份任務：每週一次
```

---

## ⏰ 常見排程設定

### Windows 工作排程器
```
特點：
✅ Windows 內建，不需額外安裝
✅ 圖形化介面，容易設定
✅ 開機後自動執行

設定方式：
1. 開啟「工作排程器」
2. 建立基本工作
3. 設定觸發條件
4. 設定要執行的程式
```

### Python schedule 套件
```python
# 簡單易用，適合 Python 專案
import schedule
import time

schedule.every().day.at("09:00").do(job)
schedule.every().hour.do(job)
schedule.every().monday.at("08:30").do(job)

while True:
    schedule.run_pending()
    time.sleep(60)
```

### Cron（Linux/Mac）
```bash
# 強大靈活，適合伺服器環境
# 分 時 日 月 週 指令

0 9 * * * python /path/to/script.py    # 每天 9:00
0 */2 * * * python script.py           # 每 2 小時
0 8 * * 1 python script.py             # 每週一 8:00
```

---

## 📂 測試資料說明

資料夾中提供了：

1. **examples/**
   - daily_report.py - 每日報表範例
   - backup_task.py - 自動備份範例
   - monitor.py - 網頁監控範例

2. **setup_scripts/**
   - windows_schedule.ps1 - Windows 排程設定
   - linux_crontab.sh - Linux crontab 設定

3. **config/**
   - schedule_config.json - 排程設定檔

---

## 🎯 挑戰任務

### 🥇 初級挑戰
- [ ] 建立每日自動執行的報表生成任務
- [ ] 設定每週備份資料夾
- [ ] 建立簡單的監控腳本

### 🥈 中級挑戰
- [ ] 建立完整的監控系統（價格、庫存、新聞）
- [ ] 實作錯誤重試和通知機制
- [ ] 建立每日摘要郵件系統

### 🥉 高級挑戰
- [ ] 建立多任務排程系統（管理多個定時任務）
- [ ] 實作任務依賴管理（任務 B 等待任務 A）
- [ ] 建立 Web 介面管理排程任務

---

## 🌟 小技巧

### 如何描述排程需求

**範例 1：明確的時間**
```
👤：每天早上 8:30 執行
    如果是週末就跳過

🤖：了解！我會設定：
    - 週一到週五 08:30
    - 週六日不執行
```

**範例 2：複雜的觸發條件**
```
👤：每小時檢查一次
    但只在上班時間（9:00-18:00）
    而且每 10 分鐘檢查一次

🤖：了解！我會設定：
    - 09:00, 09:10, 09:20 ... 17:50
    - 週一到週五
    - 週末不執行
```

---

## 🛡️ 最佳實踐

### 1. 錯誤處理
```python
👤：如果任務執行失敗怎麼辦？

🤖：我會加上完整的錯誤處理：
    try:
        execute_task()
    except Exception as e:
        log_error(e)
        send_alert(e)
        retry_task()
```

### 2. 日誌記錄
```python
👤：怎麼知道任務有沒有正常執行？

🤖：我會記錄詳細日誌：
    - 開始時間
    - 處理的資料量
    - 執行結果
    - 錯誤訊息（如果有）
    - 結束時間
    
    儲存到：logs/task_YYYY-MM-DD.log
```

### 3. 資源控制
```python
👤：任務會不會重複執行？

🤖：我會加上鎖定機制：
    - 檢查是否已在執行
    - 使用 lock 檔案防止重複
    - 執行完成後清除 lock
```

### 4. 通知機制
```python
👤：任務完成後要怎麼知道？

🤖：我可以整合多種通知：
    - Email（詳細報告）
    - Line Notify（即時通知）
    - Slack（團隊通知）
    - Discord Webhook
```

---

## 🔧 進階技巧

### 動態調整執行時間
```
👤：可以根據資料量調整執行頻率嗎？
    資料少就少檢查，資料多就多檢查

🤖：可以！我會建立智能排程：
    - 監控資料增長速度
    - 動態調整檢查間隔
    - 自動最佳化資源使用
```

### 分散式任務執行
```
👤：如果任務太多，一台電腦跑不完怎麼辦？

🤖：可以考慮：
    1. 任務分片（拆成多個小任務）
    2. 使用多個執行者（多台電腦）
    3. 使用任務佇列（Celery、RabbitMQ）
```

### 條件式執行
```
👤：只有當某個條件成立時才執行
    例如：只有當檔案存在時才處理

🤖：沒問題！我會加上條件檢查：
    if check_condition():
        execute_task()
    else:
        log_skip()
```

---

## 📊 監控與除錯

### 查看執行歷史
```
👤：怎麼知道過去 7 天的執行情況？

🤖：我會建立執行歷史儀表板：
    - 執行次數
    - 成功率
    - 平均執行時間
    - 錯誤統計
```

### 效能分析
```
👤：任務執行時間越來越長
    怎麼找出瓶頸？

🤖：我會加上效能分析：
    - 記錄每個步驟的耗時
    - 找出最慢的部分
    - 產生效能報告
```

---

記住：**好的定時任務系統讓工作自動化，讓你專注更重要的事！** ⏰
